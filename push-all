#!/bin/bash

# Colors for output
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Get the directory where the script is located
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# Function to commit changes if there are any
commit_changes() {
    local repo_name=$1
    if [[ -n $(git status --porcelain) ]]; then
        echo -e "\n${YELLOW}üìù Found changes in ${repo_name}...${NC}"
        git add .
        echo -e "${YELLOW}Enter commit message for ${repo_name} (or press enter to skip):${NC}"
        read commit_msg
        if [[ -n "$commit_msg" ]]; then
            git commit -m "$commit_msg"
            return 0
        else
            echo -e "${YELLOW}Skipping commit for ${repo_name}${NC}"
            return 1
        fi
    fi
    return 0
}

# Change to the script directory
cd "$SCRIPT_DIR"

echo -e "${GREEN}üöÄ Pushing changes to repositories...${NC}\n"

# Main repository
echo -e "${GREEN}üì¶ Processing main repository...${NC}"
if ! git rev-parse --git-dir > /dev/null 2>&1; then
    echo -e "${RED}‚ùå Not a git repository${NC}"
    exit 1
fi

# Switch to main branch
git checkout main
commit_changes "main repository"
echo -e "${GREEN}Pushing main repository...${NC}"
if git push origin main; then
    echo -e "${GREEN}‚úÖ Main repository pushed successfully${NC}"
else
    echo -e "${RED}‚ùå Failed to push main repository${NC}"
    exit 1
fi

# Private repository
echo -e "\n${GREEN}üì¶ Processing private repository...${NC}"
cd private
if ! git rev-parse --git-dir > /dev/null 2>&1; then
    echo -e "${RED}‚ùå Private directory is not a git repository${NC}"
    exit 1
fi

# Switch to main branch
git checkout main
commit_changes "private repository"
echo -e "${GREEN}Pushing private repository...${NC}"
if git push origin main; then
    echo -e "${GREEN}‚úÖ Private repository pushed successfully${NC}"
else
    echo -e "${RED}‚ùå Failed to push private repository${NC}"
    exit 1
fi

# Return to original directory
cd "$SCRIPT_DIR"

echo -e "\n${GREEN}‚ú® All repositories pushed successfully!${NC}"